{"version":3,"sources":["App.js","index.js"],"names":["_accountId","_account","_contract","_walletConnection","ContractName","TGas","Big","pow","BoatOfGas","mul","useState","imgList","setImgList","connected","setConnected","signedIn","setSignedIn","accountId","setAccountId","submitLoding","setSubmitLoding","buyLoding","setBuyLoding","Form","useForm","form","useEffect","_initNear","a","nearConfig","networkId","nodeUrl","contractName","walletUrl","keyStore","keyStores","BrowserLocalStorageKeyStore","connect","Object","assign","deps","near","WalletConnection","getAccountId","account","Contract","viewMethods","changeMethods","getList","get_list","list","requestSignIn","logOut","signOut","onFinish","opus_name","opus_url","opus_hash","price","add_picture","parseInt","pic","message","success","resetFields","signedInDom","className","onClick","dashed","wrapperCol","span","Item","label","name","rules","required","placeholder","type","htmlType","loading","map","img","i","key","width","height","fallback","src","owner","disabled","buy","pic_hash","toFixed","content","style","marginBottom","role","aria-hidden","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.fcca188e.chunk.js","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport {\n  Form,\n  Input,\n  Button,\n  Image,\n  Divider,\n  message,\n} from 'antd'\nimport {\n  keyStores,\n  connect,\n  WalletConnection,\n  Contract,\n} from 'near-api-js'\n\nimport Big from 'big.js'\n\nimport \"./App.css\"\nimport 'antd/dist/antd.css'\n\nconst ContractName = 'dev-1646638387266-60312233632745'\n\nconst TGas = Big(10).pow(12)\nconst BoatOfGas = Big(200).mul(TGas)\n\nlet _keyStore,\n  _nearConfig,\n  _near,\n  _accountId,\n  _account,\n  _contract,\n  _walletConnection\n\n\n\nexport default () => {\n\n  const [imgList, setImgList] = useState([])\n  const [connected, setConnected] = useState(false)\n  const [signedIn, setSignedIn] = useState(false)\n  const [accountId, setAccountId] = useState(null)\n  const [submitLoding, setSubmitLoding] = useState(false)\n  const [buyLoding, setBuyLoding] = useState(false)\n\n  const [form] = Form.useForm()\n\n  useEffect(() => {\n    _initNear()\n  }, [])\n\n  /**\n   * 初始化near\n   */\n  const _initNear = async () => {\n\n    const nearConfig = {\n      networkId: 'default',\n      nodeUrl: 'https://rpc.testnet.near.org',\n      contractName: ContractName,\n      walletUrl: 'https://wallet.testnet.near.org',\n    }\n\n    const keyStore = new keyStores.BrowserLocalStorageKeyStore()\n\n    const near = await connect(Object.assign({ deps: { keyStore } }, nearConfig))\n\n    _keyStore = keyStore\n    _nearConfig = nearConfig\n    _near = near\n\n    _walletConnection = new WalletConnection(near, ContractName)\n\n    _accountId = _walletConnection.getAccountId()\n\n    _account = _walletConnection.account()\n\n    _contract = new Contract(_account, ContractName, {\n      viewMethods: ['get_list'],\n      changeMethods: ['add_picture', 'buy'],\n    })\n\n    setConnected(true)\n    setSignedIn(!!_accountId)\n    setAccountId(_accountId)\n\n    if (_accountId) {\n      await getList()\n    }\n  }\n\n  /**\n   * 获取列表数据\n   */\n  const getList = async () => {\n    const list = await _contract.get_list()\n    setImgList(list)\n  }\n\n  /**\n   * 登录\n   */\n  const requestSignIn = async () => {\n    const appTitle = 'My copyright'\n    await _walletConnection.requestSignIn(\n      ContractName,\n      appTitle\n    )\n  }\n\n  /**\n   * 登出\n   */\n  const logOut = async () => {\n    _walletConnection.signOut()\n    _accountId = null\n\n    setSignedIn(false)\n    setAccountId(null)\n\n  }\n\n  /**\n   * 上传作品\n   */\n  const onFinish = async ({ opus_name, opus_url, opus_hash, price }) => {\n    if (submitLoding) return\n    setSubmitLoding(true)\n\n    const pic = await _contract.add_picture({\n      opus_name,\n      opus_url,\n      opus_hash,\n      price: parseInt(price)\n    })\n\n    setSubmitLoding(false)\n\n    if (pic === 'success') {\n      message.success('图片添加成功!')\n      form.resetFields()\n      getList()\n    } else if (pic === 'The Picture already exists') {\n      message.success('图片已存在，无法修改其他用户图片')\n      form.resetFields()\n      getList()\n    }\n  }\n\n  /**\n   * 购买\n   * @param {*} img \n   * @returns \n   */\n  const buy = (img) => {\n\n    if (buyLoding) return\n\n    setBuyLoding(true)\n\n    _contract.buy({ pic_hash: img.opus_hash }, BoatOfGas.toFixed(0), Big(img.price).mul(1000000000000000000000).toFixed(0))\n\n  }\n\n  const signedInDom = (\n    <>\n      <div className=\"float-right\">\n        <button\n          className=\"btn btn-outline-secondary\"\n          onClick={logOut}>Log out</button>\n      </div>\n      <h4>Hello, <span className=\"font-weight-bold\">{accountId}</span>!</h4>\n      <Divider dashed />\n      <Form wrapperCol={{ span: 14 }} form={form} onFinish={onFinish}>\n        <Form.Item\n          label=\"图片名称\"\n          name=\"opus_name\"\n          rules={[{ required: true, message: '请输入图片名称' }]}>\n          <Input placeholder=\"请输入图片名称\" />\n        </Form.Item>\n        <Form.Item\n          label=\"图片路径\"\n          name=\"opus_url\"\n          rules={[{ required: true, message: '请输入图片路径' }]}>\n          <Input placeholder=\"请输入图片路径\" />\n        </Form.Item>\n        <Form.Item\n          label=\"图片hash\"\n          name=\"opus_hash\"\n          rules={[{ required: true, message: '请输入图片hash' }]}>\n          <Input placeholder=\"请输入图片hash\" />\n        </Form.Item>\n        <Form.Item\n          label=\"图片价格\"\n          name=\"price\"\n          rules={[{ required: true, message: '请输入图片价格' }]}>\n          <Input placeholder=\"请输入图片价格\" />\n        </Form.Item>\n        <Form.Item >\n          <Button\n            type=\"primary\"\n            htmlType=\"submit\"\n            loading={submitLoding}\n          >Submit</Button>\n        </Form.Item>\n      </Form>\n      <Divider dashed />\n      <ul className='img_list'>\n        {\n          imgList.map((img, i) => {\n            return (\n              <li key={i}>\n                <Image\n                  width={200}\n                  height={200}\n                  fallback=\"data:image/png;base64,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\"\n                  src={img.opus_url}\n                />\n                <p className='name'>{img.opus_name}</p>\n                <p className='owner'>{img.owner}</p>\n                <p className='price'>{img.price}</p>\n                {\n                  img.owner === accountId\n                    ? <Button disabled>购买</Button>\n                    : <Button loading={buyLoding} onClick={() => buy(img)}>购买</Button>\n                }\n              </li>\n            )\n          })\n        }\n      </ul>\n    </>\n  )\n\n  const content = !connected\n    ? (\n      <div>\n        Connecting...\n        <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span>\n      </div>\n    )\n    : (\n      signedIn\n        ? signedInDom\n        : (\n          <div style={{ marginBottom: \"10px\" }}>\n            <button\n              className=\"btn btn-primary\"\n              onClick={requestSignIn}>Log in with NEAR Wallet</button>\n          </div>\n        )\n    )\n\n  return (\n    <div className=\"px-5\">\n      <h1>COPYRIGHT</h1>\n      {content}\n    </div>\n  )\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}